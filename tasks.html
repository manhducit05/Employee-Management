<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
  <title>Employee Management</title>
  <!-- CDJ Font Awesome -->

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="./assets/css/bootstrap.min.css">
  <!----css3---->
  <link rel="stylesheet" href="./assets/css/custom.css">


  <!--google fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">


  <!--google material icon-->
  <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">

</head>
<style>
  .page-item {
    padding: 0 10px;
  }

  .page-item:hover {
    cursor: pointer;
    background-color: #353B48;
    color: white;

  }

  .active {
    color: #000;
  }
</style>

<body>
  <div class="wrapper">
    <div class="body-overlay"></div>
    <!-------sidebar--design------------>

    <div id="sidebar">
      <div class="sidebar-header">
        <h3><img src="./assets/img/user.jpg" class="img-fluid" />
          <span>Admin User</span>
          <div class="dot"></div>
          <p>admin@gmail.com</p>
        </h3>
      </div>
      <ul class="list-unstyled component m-0">
        <h3 class="general">General</h3>
        <li class="active">
          <a href="dashboard.html" class="dashboard"><i class="material-icons">dashboard</i>Dashboard </a>
        </li>

        <li class="">
          <a href="department.html" class="">
            <i class="material-icons">aspect_ratio</i>Department
          </a>
        </li>

        <li class="dropdown">
          <a href="#homeSubmenu2" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
            <i class="material-icons">group</i>Employee
          </a>
          <ul class="collapse list-unstyled menu" id="homeSubmenu2">
            <li class="sortItem" value=""><a href="#">Employee chart</a></li>
            <li class="sortItem" value=""><a href="index.html">Manage employee</a></li>
            <li class="sortItem" value="age"><a href="#">Sort by age</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <a href="tasks.html" class="">
            <i class="material-icons">task</i>Task
          </a>
        </li>

        <li class="dropdown">
          <a href="#homeSubmenu5" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
            <i class="material-icons">book</i>Pages
          </a>
          <ul class="collapse list-unstyled menu" id="homeSubmenu5">
            <li><a href="/employeeManagement/introWeb/index.html">Web</a></li>
            <li><a href="#">About Us</a></li>
            <li><a href="#">Contact Us</a></li>
          </ul>
        </li>
      </ul>
    </div>

    <!-------sidebar--design- close----------->


    <!-------page-content start----------->

    <div id="content">

      <!------top-navbar-start----------->

      <div class="top-navbar" style="z-index: 0;">
        <div class="xd-topbar">
          <div class="row">
            <div class="col-2 col-md-1 col-lg-1 order-2 order-md-1 align-self-center">
              <div class="xp-menubar">
                <span class="material-icons text-white">signal_cellular_alt</span>
              </div>
            </div>

            <div class="col-md-5 col-lg-3 order-3 order-md-2">
              <div class="xp-searchbar">
                <div class="input-group">
                  <input type="search" class="form-control" placeholder="Search" id="searchUser">
                  <div class="input-group-append">
                    <button class="btn" id="button-addon2">Go
                    </button>
                  </div>
                </div>
              </div>
            </div>


            <div class="col-10 col-md-6 col-lg-8 order-1 order-md-3">
              <div class="xp-profilebar text-right">
                <nav class="navbar p-0">
                  <ul class="nav navbar-nav flex-row ml-auto">
                    <li class="dropdown nav-item active">
                      <a class="nav-link" href="#" data-toggle="dropdown">
                        <span class="material-icons">notifications</span>
                        <span class="notification">4</span>
                      </a>
                      <ul class="dropdown-menu">
                        <li><a href="#">You Have 4 New Messages</a></li>
                        <li><a href="#">You Have 4 New Messages</a></li>
                        <li><a href="#">You Have 4 New Messages</a></li>
                        <li><a href="#">You Have 4 New Messages</a></li>
                      </ul>
                    </li>

                    <li class="nav-item">
                      <a class="nav-link" href="#">
                        <span class="material-icons">question_answer</span>
                      </a>
                    </li>

                    <li class="dropdown nav-item">
                      <a class="nav-link" href="#" data-toggle="dropdown">
                        <img src="./assets/img/user.jpg" style="width:40px; border-radius:50%;" />
                        <span class="xp-user-live"></span>
                      </a>
                      <ul class="dropdown-menu small-menu">
                        <li><a href="#">
                            <span class="material-icons">person_outline</span>
                            Profile
                          </a></li>
                        <li><a href="#">
                            <span class="material-icons">settings</span>
                            Settings
                          </a></li>
                        <li><a href="#">
                            <span class="material-icons">logout</span>
                            Logout
                          </a></li>
                      </ul>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>

          <div class="xp-breadcrumbbar text-center">
            <h4 class="page-title">Dashboard</h4>
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="#">X</a></li>
              <li class="breadcrumb-item active" aria-curent="page">Dashboard</li>
            </ol>
          </div>


        </div>
      </div>
      <!------top-navbar-end----------->



      <!-- css-main-content-start -->
      <style>
        /* General Styles */
        .main-content {
          max-width: 100%;
          margin: auto;
          background: #fff;
          padding: 20px;
          border-radius: 8px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
          text-align: left;
          color: #333;
        }

        /* Button Styles */
        button.add-btn {
          background-color: #28a745;
          color: white;
          padding: 10px 20px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          margin-bottom: 20px;
        }

        button.add-btn:hover {
          background-color: #218838;
        }

        button.edit-btn {
          background-color: #007bff;
          margin-right: 8px;
          color: white;
          padding: 8px 16px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }

        button.delete-btn {
          background-color: #dc3545;
          color: white;
          padding: 8px 16px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }

        /* Table Styles */
        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 20px;
        }

        table,
        th,
        td {
          border: 1px solid #ddd;
        }

        th,
        td {
          padding: 12px;
          text-align: left;
          vertical-align: middle;
        }

        th {
          background-color: #f2f2f2;
          font-weight: bold;
        }

        /* Modal Styles */
        .modal {
          display: none;
          position: fixed;
          z-index: 1;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          overflow: auto;
          background-color: rgb(0, 0, 0);
          background-color: rgba(0, 0, 0, 0.4);
          padding-top: 60px;
        }

        .modal-content {
          background-color: #fff;
          margin: 5% auto;
          padding: 20px;
          border: 1px solid #888;
          width: 80%;
          max-width: 500px;
          border-radius: 8px;
        }

        .close {
          color: #aaa;
          float: right;
          font-size: 28px;
          font-weight: bold;
        }

        .close:hover,
        .close:focus {
          color: black;
          text-decoration: none;
          cursor: pointer;
        }

        /* Form Styles */
        #taskForm {
          display: flex;
          flex-direction: column;
        }

        #taskForm label {
          margin-top: 10px;
          margin-bottom: 5px;
          font-weight: bold;
          color: #333;
        }

        #taskForm input[type="text"],
        #taskForm input[type="date"],
        #taskForm select,
        #taskForm textarea {
          padding: 10px;
          border-radius: 4px;
          border: 1px solid #ccc;
          font-size: 14px;
          width: 100%;
          box-sizing: border-box;
        }

        #taskForm textarea {
          resize: vertical;
        }

        #taskForm button {
          margin-top: 20px;
          background-color: #007bff;
          color: white;
          padding: 10px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
        }

        #taskForm button:hover {
          background-color: #0056b3;
        }
      </style>
      <!-- css-main-content-end -->



      <!------main-content-start----------->


      <div class="main-content">
        <h2>Manage Tasks</h2>
        <button class="add-btn" onclick="openAddTaskModal()">Add Task</button>
        <table>
          <thead>
            <tr>
              <th>Task ID</th>
              <th>Task Title</th>
              <th>Department</th>
              <th>Assigned To</th>
              <th>Priority</th>
              <th>End Date</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="task-table-body">
            <!-- Task rows will be dynamically added here -->
          </tbody>
        </table>
      </div>

      <!-- Modal for adding/editing tasks -->
      <div id="taskModal" class="modal">
        <div class="modal-content">
          <span class="close" onclick="closeTaskModal()">&times;</span>
          <h2 id="modal-title">Add Task</h2>
          <form id="taskForm">
            <input type="hidden" id="taskId">

            <label for="taskTitle">Task Title:</label>
            <input type="text" id="taskTitle" name="taskTitle" required>

            <label for="taskDescription">Task Description:</label>
            <textarea id="taskDescription" name="taskDescription" required></textarea>

            <label for="departmentName">Department:</label>
            <select id="departmentName" name="departmentName" onchange="populateEmployees()" required>
              <option value="Engineering">Engineering</option>
              <option value="Marketing">Marketing</option>
              <option value="Sales">Sales</option>
              <option value="Human Resources">Human Resources</option>
              <option value="Finance">Finance</option>
              <option value="IT">IT</option>
            </select>

            <label for="assignedTo">Assigned To:</label>
            <select id="assignedTo" name="assignedTo" required>
              <!-- Employee list will be populated based on the department -->
            </select>

            <label for="taskPriority">Task Priority:</label>
            <select id="taskPriority" name="taskPriority" required>
              <option value="Normal">Normal</option>
              <option value="Medium">Medium</option>
              <option value="Urgent">Urgent</option>
              <option value="Most Urgent">Most Urgent</option>
            </select>

            <label for="endDate">Task End Date:</label>
            <input type="date" id="endDate" name="endDate" required>

            <label for="status">Status:</label>
            <select id="status" name="status" required>
              <option value="Pending">Pending</option>
              <option value="In Progress">In Progress</option>
              <option value="Completed">Completed</option>
            </select>

            <button type="button" onclick="saveTask()">Save Task</button>
          </form>
        </div>
      </div>


      <!------main-content-end----------->



      <!----footer-design------------->

      <footer class="footer">
        <div class="container-fluid">
          <div class="footer-in">
            <p class="mb-0">&copy 2024 X. All Rights Reserved.</p>
          </div>
        </div>
      </footer>
    </div>

  </div>
  <!-------complete html----------->



  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="./assets/js/jquery-3.3.1.slim.min.js"></script>
  <script src="./assets/js/popper.min.js"></script>
  <script src="./assets/js/bootstrap.min.js"></script>
  <script src="./assets/js/jquery-3.3.1.min.js"></script>
  <script src="./index.js" type="module"></script>


  <script>
    let tasks = [];
    let taskIdCounter = 1;

    const employees = {
      "Engineering": ["Le Dinh Quang Minh", "Hoang Van Binh", "Nguyen Huu Tai", "Pham Van Tung", "Hoang Van Dat", "Pham Quoc Khanh"],
      "Marketing": ["Le Tuan Dat", "Tran Thi Ngoc", "Le Minh Hoang", "Pham Thi Van"],
      "Sales": ["Tran Minh Quan", "Pham Hong Son", "Vu Van Nam", "Le Quoc Hung", "Nguyen Minh Hoa"],
      "Human Resources": ["Le Thi Lan", "Le Thi Thao", "Tran Ngoc Lan", "Tran Thu Trang", "Le Thi Hong"],
      "Finance": ["Nguyen Thi Hanh", "Hoang Thi Ha", "Pham Quang Huy", "Nguyen Thu Ha", "Le Thi Xuan", "Nguyen Thu Thuy"],
      "IT": ["Do Manh Hung", "Hoang Van Cuong", "Hoang Van Dung", "Tran Minh Tuan"]
    };

    function openAddTaskModal() {
      document.getElementById('taskForm').reset();
      document.getElementById('taskId').value = '';
      document.getElementById('modal-title').textContent = 'Add Task';
      document.getElementById('taskModal').style.display = 'block';
    }

    function closeTaskModal() {
      document.getElementById('taskModal').style.display = 'none';
    }

    function saveTask() {
      const taskId = document.getElementById('taskId').value || taskIdCounter++;
      const taskTitle = document.getElementById('taskTitle').value;
      const taskDescription = document.getElementById('taskDescription').value;
      const departmentName = document.getElementById('departmentName').value;
      const assignedTo = document.getElementById('assignedTo').value;
      const taskPriority = document.getElementById('taskPriority').value;
      const endDate = document.getElementById('endDate').value;
      const status = document.getElementById('status').value;

      const task = { id: taskId, taskTitle, taskDescription, departmentName, assignedTo, taskPriority, endDate, status };

      const method = document.getElementById('taskId').value ? 'PUT' : 'POST';
      const url = method === 'PUT' ? `http://localhost:3000/task/${taskId}` : 'http://localhost:3000/task';

      fetch(url, {
        method: method,
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(task),
      })
        .then(response => {
          if (response.ok) {
            return response.json();
          }
          throw new Error('Network response was not ok.');
        })
        .then(data => {
          console.log('Success:', data);
          if (method === 'POST') tasks.push(data);
          updateTaskTable();
          closeTaskModal();
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    }


    function updateTaskTable() {
      fetch('http://localhost:3000/task')
        .then(response => response.json())
        .then(tasks => {
          const tbody = document.getElementById('task-table-body');
          tbody.innerHTML = '';

          tasks.forEach(task => {
            const row = document.createElement('tr');
            row.innerHTML = `
          <td>${task.id}</td>
          <td>${task.taskTitle}</td>
          <td>${task.departmentName}</td>
          <td>${task.assignedTo}</td>
          <td>${task.taskPriority}</td>
          <td>${task.endDate}</td>
          <td>${task.status}</td>
          <td>
            <button class="edit-btn" onclick="editTask(${task.id})">Edit</button>
            <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>
          </td>
        `;
            tbody.appendChild(row);
          });
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    }

    function editTask(id) {
      fetch(`http://localhost:3000/task/${id}`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(task => {
          // Gán giá trị cho các input fields
          document.getElementById('taskId').value = task.id;
          document.getElementById('taskTitle').value = task.taskTitle;
          document.getElementById('taskDescription').value = task.taskDescription;
          document.getElementById('departmentName').value = task.departmentName;

          // Gọi hàm populateEmployees để cập nhật danh sách nhân viên dựa trên phòng ban
          populateEmployees();

          // Gán giá trị tiếp tục sau khi cập nhật danh sách nhân viên
          document.getElementById('assignedTo').value = task.assignedTo;
          document.getElementById('taskPriority').value = task.taskPriority;
          document.getElementById('endDate').value = task.endDate;
          document.getElementById('status').value = task.status;

          // Hiển thị modal chỉnh sửa
          document.getElementById('modal-title').textContent = 'Edit Task';
          document.getElementById('taskModal').style.display = 'block';
        })
        .catch(error => {
          console.error('There was a problem with the fetch operation:', error);
        });
    }


    function deleteTask(id) {
      fetch(`http://localhost:3000/task/${id}`, {
        method: 'DELETE',
      })
        .then(() => {
          tasks = tasks.filter(task => task.id != id);
          updateTaskTable();
        })
        .catch((error) => {
          console.error('Error:', error);
        });
    }

    function populateEmployees() {
      const departmentName = document.getElementById('departmentName').value;
      const employeeSelect = document.getElementById('assignedTo');
      employeeSelect.innerHTML = '';

      employees[departmentName].forEach(employee => {
        const option = document.createElement('option');
        option.value = employee;
        option.textContent = employee;
        employeeSelect.appendChild(option);
      });
    }

    window.onclick = function (event) {
      const modal = document.getElementById('taskModal');
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }

    // Khi trang được load lần đầu tiên, hãy tải danh sách tasks từ server
    window.onload = updateTaskTable;



  </script>


  <script type="text/javascript">
    $(document).ready(function () {
      $(".xp-menubar").on('click', function () {
        $("#sidebar").toggleClass('active');
        $("#content").toggleClass('active');
      });

      $('.xp-menubar,.body-overlay').on('click', function () {
        $("#sidebar,.body-overlay").toggleClass('show-nav');
      });

    });
  </script>

</body>

</html>